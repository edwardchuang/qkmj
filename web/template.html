<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="mobile-web-app-capable" content="yes">
    <title>QKMJ Online - 傳統麻將俱樂部</title>
    <link inline rel="icon" type="image/png" href="favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Noto+Serif+TC:wght@900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --table-green: #1b5e20;
            --table-felt: #2e7d32;
            --wood-dark: #3e2723;
            --wood-light: #5d4037;
            --gold: #d4af37;
            --text-muted: rgba(255, 255, 255, 0.5);
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background-color: var(--table-green);
            /* 模擬尼龍氈材質的紋理 */
            background-image: 
                radial-gradient(circle at center, rgba(255,255,255,0.15) 0%, transparent 80%),
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            background-blend-mode: overlay;
            overflow: hidden;
            font-family: 'Noto Sans TC', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* 外部大框架：模擬嵌入式牌桌 */
        #table-surface {
            position: relative;
            padding: 40px;
            background: rgba(0,0,0,0.1);
            border-radius: 20px;
            box-shadow: 0 0 100px rgba(0,0,0,0.4);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #terminal-scaler {
            transition: transform 0.2s ease-out;
            transform-origin: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 終端機容器：高級紅木邊框 */
        .terminal-wrapper {
            padding: 12px;
            background: #000 !important;
            border: 12px solid var(--wood-dark);
            border-image: linear-gradient(to bottom right, var(--wood-light), var(--wood-dark)) 1;
            border-radius: 4px;
            outline: 2px solid var(--gold);
            outline-offset: -14px;
            box-shadow: 
                0 40px 80px rgba(0,0,0,0.8), 
                0 0 30px rgba(0,0,0,0.5),
                inset 0 0 10px rgba(0,0,0,1);
        }

        /* 介面裝飾文字 */
        #ui-overlay {
            position: absolute;
            top: 30px;
            right: 40px;
            color: rgba(255,255,255,0.8);
            pointer-events: none;
            text-align: right;
            z-index: 100;
        }

        #ui-overlay h1 {
            font-family: 'Noto Serif TC', serif;
            font-size: 28px;
            margin: 0 0 10px 0;
            color: var(--gold);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            letter-spacing: 4px;
        }

        .hotkey-list {
            font-size: 14px;
            line-height: 1.8;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-right: 3px solid var(--gold);
            backdrop-filter: blur(5px);
        }

        /* 底部導覽列 */
        #footer {
            position: absolute;
            bottom: 30px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 40px;
            box-sizing: border-box;
            z-index: 100;
        }

        .footer-links {
            display: flex;
            gap: 20px;
        }

        .footer-links a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: var(--gold);
        }

        #branding {
            color: var(--text-muted);
            font-size: 12px;
            letter-spacing: 6px;
            text-transform: uppercase;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        /* 修復 xterm 行高 */
        .xterm-rows {
            font-variant-ligatures: none;
        }
    </style>

    <% for (const css in htmlWebpackPlugin.files.css) { %>
    <link inline rel="stylesheet" type="text/css" href="<%= htmlWebpackPlugin.files.css[css] %>">
    <% } %>
</head>
<body>

<div id="ui-overlay">
    <h1>QKMJ ONLINE</h1>
    <div class="hotkey-list">
        [ 方向鍵 ] 移動游標<br>
        [ ENTER ] 決定 / 出牌<br>
        [ SPACE ] 整理手牌<br>
        [ T ] 開啟聊天室<br>
        [ A ] 開啟/關閉 AI
    </div>
</div>

<div id="table-surface">
    <div id="terminal-scaler">
        <div id="terminal-container">
            <!-- 終端機將被動態移入 -->
        </div>
    </div>
</div>

<div id="footer">
    <div id="branding">休息室 — MAHJONG PARLOR —</div>
    <div class="footer-links">
        <a href="https://github.com/edwardchuang/qkmj" target="_blank">
            <svg height="16" width="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
            GitHub
        </a>
        <a href="https://github.com/edwardchuang/qkmj/issues/new" target="_blank">
            <svg height="16" width="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
            回報問題
        </a>
    </div>
</div>

<script>
    window.ttyd_options = {
        fontSize: 18,
        fontFamily: "'Sarasa Mono TC', 'Microsoft JhengHei', 'PingFang TC', 'Noto Sans TC', monospace",
        lineHeight: 1.15,
        theme: {
            background: '#000000',
            foreground: '#dcdccc',
            cursor: '#ffb86c',
            black: '#000000',
            red: '#ff5555',
            green: '#50fa7b',
            yellow: '#f1fa8c',
            blue: '#bd93f9',
            magenta: '#ff79c6',
            cyan: '#8be9fd',
            white: '#f8f8f2'
        }
    };

    function scaleTerminal() {
        const scaler = document.getElementById('terminal-scaler');
        const terminal = document.querySelector('.terminal-wrapper');
        if (!terminal) return;

        const padding = 160; 
        const availableWidth = window.innerWidth - padding;
        const availableHeight = window.innerHeight - padding;
        
        const termWidth = terminal.offsetWidth;
        const termHeight = terminal.offsetHeight;
        
        const scaleX = availableWidth / termWidth;
        const scaleY = availableHeight / termHeight;
        const scale = Math.min(scaleX, scaleY, 1.5);

        scaler.style.transform = `scale(${scale})`;
    }

    document.addEventListener('DOMContentLoaded', function() {
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.nodeType === 1 && (node.classList.contains('terminal') || node.id === 'terminal')) {
                        node.classList.add('terminal-wrapper');
                        document.getElementById('terminal-container').appendChild(node);
                        setTimeout(scaleTerminal, 100);
                    }
                });
            });
        });
        observer.observe(document.body, { childList: true });
    });

    window.addEventListener('resize', scaleTerminal);
</script>

<% for (const js in htmlWebpackPlugin.files.js) { %>
<script inline type="text/javascript" src="<%= htmlWebpackPlugin.files.js[js] %>"></script>
<% } %>
</body>
</html>