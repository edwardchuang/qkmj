<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="mobile-web-app-capable" content="yes">
    <title>QKMJ Online - 傳統麻將俱樂部</title>
    <link inline rel="icon" type="image/png" href="favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Noto+Serif+TC:wght@900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --table-green: #1b5e20;
            --table-felt: #2e7d32;
            --wood-dark: #3e2723;
            --wood-light: #5d4037;
            --gold: #d4af37;
            --text-muted: rgba(255, 255, 255, 0.5);
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background-color: var(--table-green);
            /* 模擬尼龍氈材質的紋理 */
            background-image: 
                radial-gradient(circle at center, rgba(255,255,255,0.15) 0%, transparent 80%),
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            background-blend-mode: overlay;
            overflow: hidden;
            font-family: 'Noto Sans TC', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* 外部大框架：模擬嵌入式牌桌 */
        #table-surface {
            position: relative;
            padding: 40px;
            background: rgba(0,0,0,0.1);
            border-radius: 20px;
            box-shadow: 0 0 100px rgba(0,0,0,0.4);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #terminal-scaler {
            transition: transform 0.2s ease-out;
            transform-origin: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 終端機容器：高級紅木邊框 */
        .terminal-wrapper {
            padding: 12px;
            background: #000 !important;
            border: 12px solid var(--wood-dark);
            border-image: linear-gradient(to bottom right, var(--wood-light), var(--wood-dark)) 1;
            border-radius: 4px;
            outline: 2px solid var(--gold);
            outline-offset: -14px;
            box-shadow: 
                0 40px 80px rgba(0,0,0,0.8), 
                0 0 30px rgba(0,0,0,0.5),
                inset 0 0 10px rgba(0,0,0,1);
        }

        /* 介面裝飾文字 */
        #ui-overlay {
            position: absolute;
            top: 30px;
            right: 40px;
            color: rgba(255,255,255,0.8);
            pointer-events: none;
            text-align: right;
            z-index: 100;
        }

        #ui-overlay h1 {
            font-family: 'Noto Serif TC', serif;
            font-size: 28px;
            margin: 0 0 10px 0;
            color: var(--gold);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            letter-spacing: 4px;
        }

        .hotkey-list {
            font-size: 14px;
            line-height: 1.8;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-right: 3px solid var(--gold);
            backdrop-filter: blur(5px);
        }

        /* 底部導覽列 */
        #footer {
            position: absolute;
            bottom: 30px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 40px;
            box-sizing: border-box;
            z-index: 100;
        }

        .footer-links {
            display: flex;
            gap: 20px;
        }

        .footer-links a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: var(--gold);
        }

        #branding {
            color: var(--text-muted);
            font-size: 12px;
            letter-spacing: 6px;
            text-transform: uppercase;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        /* 修復 xterm 行高 */
        .xterm-rows {
            font-variant-ligatures: none;
        }

        /* 聲明彈窗樣式 */
        #consent-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }

        #consent-modal {
            max-width: 650px;
            width: 90%;
            background: #121212;
            border: 4px solid var(--wood-dark);
            outline: 1px solid var(--gold);
            outline-offset: -5px;
            padding: 40px;
            color: #dcdccc;
            box-shadow: 0 0 100px rgba(0,0,0,1);
            position: relative;
            animation: modalFadeIn 0.5s ease-out;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #consent-modal h2 {
            font-family: 'Noto Serif TC', serif;
            color: var(--gold);
            margin-top: 0;
            border-bottom: 2px solid var(--gold);
            padding-bottom: 15px;
            text-align: center;
            letter-spacing: 2px;
        }

        .consent-content {
            font-size: 14px;
            line-height: 1.8;
            max-height: 60vh;
            overflow-y: auto;
            margin: 25px 0;
            padding-right: 15px;
            text-align: justify;
        }

        .consent-content h3 {
            color: var(--gold);
            font-size: 16px;
            margin-bottom: 8px;
        }

        .consent-content hr {
            border: 0;
            border-top: 1px dashed var(--text-muted);
            margin: 25px 0;
        }

        #consent-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: var(--table-felt);
            color: white;
            border: 2px solid var(--gold);
            cursor: pointer;
            font-family: 'Noto Sans TC', sans-serif;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s;
            letter-spacing: 4px;
            text-transform: uppercase;
        }

        #consent-btn:hover {
            background: var(--gold);
            color: var(--wood-dark);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
        }

        /* 隱藏滾動條但保持功能 */
        .consent-content::-webkit-scrollbar { width: 4px; }
        .consent-content::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        .consent-content::-webkit-scrollbar-thumb { background: var(--wood-light); }
    </style>

    <% for (const css in htmlWebpackPlugin.files.css) { %>
    <link inline rel="stylesheet" type="text/css" href="<%= htmlWebpackPlugin.files.css[css] %>">
    <% } %>
</head>
<body>

<div id="consent-overlay">
    <div id="consent-modal">
        <h2>法律免責聲明 / Legal Disclaimer</h2>
        <div class="consent-content">
            <section>
                <h3>【繁體中文】</h3>
                <p>1. <strong>研究性質</strong>：本網站及其相關系統（以下簡稱「本服務」）係專為學術研究、演算法開發及技術測試之目的而設計，不具備任何博弈、賭博或非法營利之意圖。</p>
                <p>2. <strong>非博弈性質</strong>：本服務與任何商業博弈行為無涉。系統內不提供任何真實金錢與虛擬點數之兌換功能。</p>
                <p>3. <strong>無價值聲明</strong>：遊戲中所有積分、數值及排名僅作為技術測試與競爭模擬之指標。該等數值不具備任何物理價值、經濟價值，亦不得兌換為現金、商品、有價證券或其他形式之利益。</p>
                <p>4. <strong>免責聲明</strong>：本服務按「現況」提供，開發者與託管者對於本服務之穩定性、可用性、資料準確性或安全性，不提供任何明示或暗示之保證。</p>
                <p>5. <strong>合規與同意</strong>：進入本網站即代表您已充分閱讀、理解並無條件同意上述所有條款。</p>
                <p>6. <strong>最終解釋權</strong>：本服務及其相關條款之最終解釋權，在法律允許之範圍內，均歸屬本網站託管人所有。</p>
            </section>
            
            <hr>
            
            <section>
                <h3>【English】</h3>
                <p>1. <strong>Academic Nature</strong>: This website and its associated systems (the "Service") are developed exclusively for academic research, algorithmic development, and technical testing purposes. It is not intended for gambling or any commercial profit.</p>
                <p>2. <strong>No Gambling Affiliation</strong>: The Service is not affiliated with any gambling enterprise. No real-money gambling or gambling-for-profit functionality is provided within this system.</p>
                <p>3. <strong>No Monetary Value</strong>: All points, scores, and rankings within the game are strictly for simulation and testing purposes. These values hold no physical or economic value and are non-exchangeable for cash, goods, securities, or any other form of benefit.</p>
                <p>4. <strong>Warranty Disclaimer</strong>: The Service is provided on an "AS IS" and "AS AVAILABLE" basis. The developers and hosts provide no warranties, express or implied, regarding the stability, accuracy, or security of the Service.</p>
                <p>5. <strong>Consent</strong>: By accessing this website, you acknowledge that you have been informed of these terms and hereby provide your explicit and unconditional consent.</p>
                <p>6. <strong>Final Interpretation</strong>: To the extent permitted by law, the host of this Service reserves the right of final interpretation regarding these terms and the Service itself.</p>
            </section>
        </div>
        <button id="consent-btn">我已閱讀並同意上述條款 / I AGREE</button>
    </div>
</div>

<script>
    (function() {
        try {
            var STORAGE_KEY = 'qkmj_consent_data';
            var TTL_MS = 24 * 60 * 60 * 1000;
            
            // Store the HTML template so we can re-inject it if wiped
            var modalHtml = 
                '<div id="consent-modal">' +
                '    <h2>法律免責聲明 / Legal Disclaimer</h2>' +
                '    <div class="consent-content">' +
                '        <section>' +
                '            <h3>【繁體中文】</h3>' +
                '            <p>1. <strong>研究性質</strong>：本網站及其相關系統（以下簡稱「本服務」）係專為學術研究、演算法開發及技術測試之目的而設計，不具備任何博弈、賭博或非法營利之意圖。</p>' +
                '            <p>2. <strong>非博弈性質</strong>：本服務與任何商業博弈行為無涉。系統內不提供任何真實金錢與虛擬點數之兌換功能。</p>' +
                '            <p>3. <strong>無價值聲明</strong>：遊戲中所有積分、數值及排名僅作為技術測試與競爭模擬之指標。該等數值不具備任何物理價值、經濟價值，亦不得兌換為現金、商品、有價證券或其他形式之利益。</p>' +
                '            <p>4. <strong>免責聲明</strong>：本服務按「現況」提供，開發者與託管者對於本服務之穩定性、可用性、資料準確性或安全性，不提供任何明示或暗示之保證。</p>' +
                '            <p>5. <strong>合規與同意</strong>：進入本網站即代表您已充分閱讀、理解並無條件同意上述所有條款。</p>' +
                '            <p>6. <strong>最終解釋權</strong>：本服務及其相關條款之最終解釋權，在法律允許之範圍內，均歸屬本網站託管人所有。</p>' +
                '        </section>' +
                '        <hr>' +
                '        <section>' +
                '            <h3>【English】</h3>' +
                '            <p>1. <strong>Academic Nature</strong>: This website and its associated systems (the "Service") are developed exclusively for academic research, algorithmic development, and technical testing purposes. It is not intended for gambling or any commercial profit.</p>' +
                '            <p>2. <strong>No Gambling Affiliation</strong>: The Service is not affiliated with any gambling enterprise. No real-money gambling or gambling-for-profit functionality is provided within this system.</p>' +
                '            <p>3. <strong>No Monetary Value</strong>: All points, scores, and rankings within the game are strictly for simulation and testing purposes. These values hold no physical or economic value and are non-exchangeable for cash, goods, securities, or any other form of benefit.</p>' +
                '            <p>4. <strong>Warranty Disclaimer</strong>: The Service is provided on an "AS IS" and "AS AVAILABLE" basis. The developers and hosts provide no warranties, express or implied, regarding the stability, accuracy, or security of the Service.</p>' +
                '            <p>5. <strong>Consent</strong>: By accessing this website, you acknowledge that you have been informed of these terms and hereby provide your explicit and unconditional consent.</p>' +
                '            <p>6. <strong>Final Interpretation</strong>: To the extent permitted by law, the host of this Service reserves the right of final interpretation regarding these terms and the Service itself.</p>' +
                '        </section>' +
                '    </div>' +
                '    <button id="consent-btn">我已閱讀並同意上述條款 / I AGREE</button>' +
                '</div>';

            window.isConsentValid = function() {
                var itemStr = localStorage.getItem(STORAGE_KEY);
                if (!itemStr) return false;
                try {
                    var item = JSON.parse(itemStr);
                    return (new Date().getTime() <= item.expiry) && (item.value === 'true');
                } catch (e) { return false; }
            };

            function ensureModal() {
                if (window.isConsentValid()) return;
                
                var overlay = document.getElementById('consent-overlay');
                if (!overlay) {
                    overlay = document.createElement('div');
                    overlay.id = 'consent-overlay';
                    document.body.appendChild(overlay);
                }
                
                if (!document.getElementById('consent-modal')) {
                    overlay.innerHTML = modalHtml;
                    document.getElementById('consent-btn').addEventListener('click', function() {
                        localStorage.setItem(STORAGE_KEY, JSON.stringify({
                            value: 'true',
                            expiry: new Date().getTime() + TTL_MS
                        }));
                        overlay.style.display = 'none';
                    });
                }
                overlay.style.display = 'flex';
            }

            // Run immediately
            ensureModal();
            // Also run after terminal might have wiped the body
            setTimeout(ensureModal, 500);
            setTimeout(ensureModal, 2000);
            
        } catch (e) { console.error("Consent script error:", e); }
    })();
</script>

<div id="ui-overlay">
    <h1>QKMJ ONLINE</h1>
    <div class="hotkey-list">
        [ 方向鍵 ] 移動游標<br>
        [ ENTER ] 決定 / 出牌<br>
        [ SPACE ] 整理手牌<br>
        [ T ] 開啟聊天室<br>
        [ A ] 開啟/關閉 AI
    </div>
</div>

<div id="table-surface">
    <div id="terminal-scaler">
        <div id="terminal-container">
            <!-- 終端機將被動態移入 -->
        </div>
    </div>
</div>

<div id="footer">
    <div id="branding">休息室 — MAHJONG PARLOR —</div>
    <div class="footer-links">
        <a href="https://github.com/edwardchuang/qkmj" target="_blank">
            <svg height="16" width="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
            GitHub
        </a>
        <a href="https://github.com/edwardchuang/qkmj/issues/new" target="_blank">
            <svg height="16" width="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
            回報問題
        </a>
    </div>
</div>

<script>
    window.ttyd_options = {
        fontSize: 18,
        fontFamily: "'Sarasa Mono TC', 'Microsoft JhengHei', 'PingFang TC', 'Noto Sans TC', monospace",
        lineHeight: 1.15,
        theme: {
            background: '#000000',
            foreground: '#dcdccc',
            cursor: '#ffb86c',
            black: '#000000',
            red: '#ff5555',
            green: '#50fa7b',
            yellow: '#f1fa8c',
            blue: '#bd93f9',
            magenta: '#ff79c6',
            cyan: '#8be9fd',
            white: '#f8f8f2'
        }
    };

    function scaleTerminal() {
        const scaler = document.getElementById('terminal-scaler');
        const terminal = document.querySelector('.terminal-wrapper');
        if (!terminal) return;

        const padding = 160; 
        const availableWidth = window.innerWidth - padding;
        const availableHeight = window.innerHeight - padding;
        
        const termWidth = terminal.offsetWidth;
        const termHeight = terminal.offsetHeight;
        
        const scaleX = availableWidth / termWidth;
        const scaleY = availableHeight / termHeight;
        const scale = Math.min(scaleX, scaleY, 1.5);

        scaler.style.transform = `scale(${scale})`;
    }

    document.addEventListener('DOMContentLoaded', function() {
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.nodeType === 1 && (node.classList.contains('terminal') || node.id === 'terminal')) {
                        node.classList.add('terminal-wrapper');
                        document.getElementById('terminal-container').appendChild(node);
                        setTimeout(scaleTerminal, 100);
                    }
                });
            });
        });
        observer.observe(document.body, { childList: true });
    });

    window.addEventListener('resize', scaleTerminal);
</script>

<% for (const js in htmlWebpackPlugin.files.js) { %>
<script inline type="text/javascript" src="<%= htmlWebpackPlugin.files.js[js] %>"></script>
<% } %>
</body>
</html>